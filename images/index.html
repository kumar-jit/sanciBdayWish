<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HBD SANCI! ‚ú®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #ffdde1, #ee9ca7);
            overflow-x: hidden;
        }
        .text-shadow-pop {
            text-shadow: 2px 2px 0px rgba(255, 255, 255, 0.5), 4px 4px 0px rgba(0, 0, 0, 0.1);
        }
        .card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .photo-placeholder {
            background: rgba(255, 255, 255, 0.3);
            border: 2px dashed #fff;
            position: relative;
            overflow: hidden;
        }
        .photo-placeholder::before {
            content: 'drop a cute pic here ‚ú®';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-weight: 600;
            text-align: center;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 1s ease-out forwards;
        }
        .delay-1 { animation-delay: 0.2s; }
        .delay-2 { animation-delay: 0.4s; }
        .delay-3 { animation-delay: 0.6s; }
        .delay-4 { animation-delay: 0.8s; }
        .delay-5 { animation-delay: 1.0s; }
        .delay-6 { animation-delay: 1.2s; }

        #cake-canvas {
            cursor: grab;
        }
        #cake-canvas:active {
            cursor: grabbing;
        }
        #blow-instruction {
            transition: opacity 0.5s;
        }

        /* Horizontal scroll container */
        .horizontal-scroll-container {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
            overflow-x: auto;
        }
        .horizontal-scroll-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto px-4 py-8 min-h-screen flex flex-col justify-center items-center">
        <!-- Main Title -->
        <header class="text-center mb-8">
            <h1 class="text-5xl md:text-7xl font-black text-white text-shadow-pop fade-in">HBD SANCI! ü•≥</h1>
            <p class="text-xl text-white mt-2 font-semibold fade-in delay-1">it's your main character moment</p>
        </header>

        <!-- Photo Gallery Section -->
        <section class="w-full max-w-5xl text-center mb-8">
             <h2 class="text-3xl font-bold text-white mb-6 fade-in delay-2">CORE MEMORIES üéûÔ∏è</h2>
             <div class="horizontal-scroll-container">
                <div class="flex gap-4 pb-4 px-4">
                    <!-- User will replace these divs with img tags -->
                    <div class="photo-placeholder w-40 h-40 md:w-52 md:h-52 flex-shrink-0 rounded-2xl card fade-in delay-3"></div>
                    <div class="photo-placeholder w-40 h-40 md:w-52 md:h-52 flex-shrink-0 rounded-2xl card fade-in delay-3"></div>
                    <div class="photo-placeholder w-40 h-40 md:w-52 md:h-52 flex-shrink-0 rounded-2xl card fade-in delay-3"></div>
                    <div class="photo-placeholder w-40 h-40 md:w-52 md:h-52 flex-shrink-0 rounded-2xl card fade-in delay-3"></div>
                    <div class="photo-placeholder w-40 h-40 md:w-52 md:h-52 flex-shrink-0 rounded-2xl card fade-in delay-3"></div>
                    <div class="photo-placeholder w-40 h-40 md:w-52 md:h-52 flex-shrink-0 rounded-2xl card fade-in delay-3"></div>
                </div>
            </div>
        </section>

        <!-- 3D Cake Section -->
        <div class="w-full max-w-lg h-96 mb-8 fade-in delay-4">
            <div id="cake-container" class="relative w-full h-full rounded-2xl overflow-hidden">
                 <canvas id="cake-canvas"></canvas>
                 <div id="blow-instruction" class="absolute bottom-4 left-1/2 -translate-x-1/2 text-center text-white bg-black bg-opacity-30 p-2 rounded-lg pointer-events-none">
                     <p id="instruction-text" class="font-semibold">Click to light the candle!</p>
                 </div>
            </div>
        </div>

        <!-- Wishes Section -->
        <section class="w-full max-w-4xl text-center mb-12">
            <h2 class="text-3xl font-bold text-white mb-6 fade-in delay-5">THE GLOW UP IS REAL</h2>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="card p-6 rounded-2xl fade-in delay-6">
                    <h3 class="font-bold text-xl mb-2 text-pink-700">Another trip around the sun ‚òÄÔ∏è</h3>
                    <p class="text-pink-900">Hope this year is filled with good vibes, iconic moments, and zero drama. You totally deserve it!</p>
                </div>
                <div class="card p-6 rounded-2xl fade-in delay-6">
                    <h3 class="font-bold text-xl mb-2 text-pink-700">Manifesting the best for you ‚ú®</h3>
                    <p class="text-pink-900">Wishing you a year of success, happiness, and hitting all your goals. Go get 'em, queen!</p>
                </div>
            </div>
        </section>
        
        <footer class="text-center text-white mt-12 pb-4 fade-in delay-6">
            <p>Made with ‚ù§Ô∏è for the one and only Sanci.</p>
        </footer>

    </div>

    <script>
        // --- THREE.JS SCENE SETUP ---
        const canvas = document.getElementById('cake-canvas');
        const container = document.getElementById('cake-container');
        let scene, camera, renderer, cake, candleLight, flame, confetti_particles;
        let isCandleLit = false;

        function init3D() {
            scene = new THREE.Scene();
            
            // Camera
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.z = 5;
            camera.position.y = 2;

            // Renderer
            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 10, 7.5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);

            // Cake
            createCake();

            // Controls for rotation
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };
            
            const onMouseDown = (e) => { isDragging = true; };
            const onMouseUp = () => { isDragging = false; };
            const onMouseMove = (e) => {
                if (!isDragging) return;
                const deltaMove = {
                    x: e.offsetX - previousMousePosition.x,
                    y: e.offsetY - previousMousePosition.y
                };
                
                if (cake) {
                    cake.rotation.y += deltaMove.x * 0.01;
                }

                previousMousePosition = { x: e.offsetX, y: e.offsetY };
            };
            const onTouchStart = (e) => {
                isDragging = true;
                previousMousePosition = { x: e.touches[0].clientX, y: e.touches[0].clientY };
            };
            const onTouchMove = (e) => {
                if (!isDragging) return;
                 const deltaMove = {
                    x: e.touches[0].clientX - previousMousePosition.x,
                };
                if(cake) cake.rotation.y += deltaMove.x * 0.02;
                previousMousePosition = { x: e.touches[0].clientX, y: e.touches[0].clientY };
            };
            
            renderer.domElement.addEventListener('mousedown', onMouseDown);
            renderer.domElement.addEventListener('mouseup', onMouseUp);
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            renderer.domElement.addEventListener('touchstart', onTouchStart, { passive: true });
            renderer.domElement.addEventListener('touchend', onMouseUp);
            renderer.domElement.addEventListener('touchmove', onTouchMove, { passive: true });
            

            animate();
        }

        function createCake() {
            cake = new THREE.Group();

            // Cake layers
            const baseMaterial = new THREE.MeshStandardMaterial({ color: 0xffafcc, roughness: 0.8 });
            const baseGeometry = new THREE.CylinderGeometry(2, 2, 1, 32);
            const base = new THREE.Mesh(baseGeometry, baseMaterial);
            base.castShadow = true;
            base.receiveShadow = true;
            cake.add(base);

            const topLayerMaterial = new THREE.MeshStandardMaterial({ color: 0xffc8dd, roughness: 0.8 });
            const topLayerGeometry = new THREE.CylinderGeometry(1.5, 1.5, 0.8, 32);
            const topLayer = new THREE.Mesh(topLayerGeometry, topLayerMaterial);
            topLayer.position.y = 0.9;
            topLayer.castShadow = true;
            topLayer.receiveShadow = true;
            cake.add(topLayer);
            
            // Icing
            const icingMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.5 });
            const icingGeometry = new THREE.TorusGeometry(1.7, 0.3, 16, 100);
            const icing = new THREE.Mesh(icingGeometry, icingMaterial);
            icing.rotation.x = Math.PI / 2;
            icing.position.y = 0.5;
            cake.add(icing);
            
            // Candle
            const candle = new THREE.Group();
            const waxMaterial = new THREE.MeshStandardMaterial({ color: 0xfefae0 });
            const waxGeometry = new THREE.CylinderGeometry(0.08, 0.08, 0.7, 16);
            const wax = new THREE.Mesh(waxGeometry, waxMaterial);
            wax.castShadow = true;
            candle.add(wax);

            // Flame
            const flameMaterial = new THREE.MeshBasicMaterial({ color: 0xffd700 });
            const flameGeometry = new THREE.ConeGeometry(0.08, 0.2, 16);
            flame = new THREE.Mesh(flameGeometry, flameMaterial);
            flame.position.y = 0.45;
            flame.visible = false;
            candle.add(flame);
            
            candle.position.y = 1.6;
            cake.add(candle);
            
            // Candle Light
            candleLight = new THREE.PointLight(0xffaa33, 1, 100);
            candleLight.position.set(0, 2.2, 0);
            candleLight.castShadow = true;
            candleLight.intensity = 0; // Off by default
            scene.add(candleLight);

            scene.add(cake);
        }

        function createConfetti() {
            const confettiCount = 200;
            const confettiGeometry = new THREE.PlaneGeometry(0.07, 0.07);
            const colors = [0xffd700, 0xffafcc, 0xffffff, 0xee9ca7];
            confetti_particles = new THREE.Group();

            for (let i = 0; i < confettiCount; i++) {
                const confettiMaterial = new THREE.MeshBasicMaterial({ color: colors[Math.floor(Math.random() * colors.length)], side: THREE.DoubleSide });
                const particle = new THREE.Mesh(confettiGeometry, confettiMaterial);

                particle.position.set(
                    (Math.random() - 0.5) * 0.5,
                    2 + Math.random() * 1.5,
                    (Math.random() - 0.5) * 0.5
                );

                particle.rotation.set( Math.random() * Math.PI, Math.random() * Math.PI, Math.random() * Math.PI );
                
                particle.velocity = new THREE.Vector3( (Math.random() - 0.5) * 0.03, Math.random() * 0.05 + 0.05, (Math.random() - 0.5) * 0.03 );
                particle.rotationSpeed = new THREE.Vector3( (Math.random() - 0.5) * 0.1, (Math.random() - 0.5) * 0.1, (Math.random() - 0.5) * 0.1);

                confetti_particles.add(particle);
            }
            scene.add(confetti_particles);
        }

        function animate() {
            requestAnimationFrame(animate);
            if (flame && flame.visible) {
                // Flicker animation
                flame.scale.y = 1 + Math.sin(Date.now() * 0.05) * 0.1;
                flame.scale.x = 1 + Math.cos(Date.now() * 0.05) * 0.05;
                candleLight.intensity = 1.5 + Math.sin(Date.now() * 0.05) * 0.2;
            }

            if (confetti_particles) {
                confetti_particles.children.forEach(particle => {
                    particle.position.add(particle.velocity);
                    particle.velocity.y -= 0.0008; // gravity

                    particle.rotation.x += particle.rotationSpeed.x;
                    particle.rotation.y += particle.rotationSpeed.y;
                    particle.rotation.z += particle.rotationSpeed.z;

                    if (particle.position.y < -3) {
                       particle.position.y = 3;
                       particle.velocity.y = Math.random() * 0.05 + 0.02;
                    }
                });
            }

            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        window.addEventListener('resize', onWindowResize, false);

        init3D();

        // --- BLOWING FEATURE ---
        let audioContext;
        let analyser;
        let microphone;
        
        const instructionText = document.getElementById('instruction-text');
        
        canvas.addEventListener('click', () => {
            if (!isCandleLit) {
                lightCandle();
            }
        });

        async function lightCandle() {
            isCandleLit = true;
            flame.visible = true;
            candleLight.intensity = 2;
            instructionText.textContent = "Make a wish and blow out the candle!";
            
            // Start audio context on user gesture
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    microphone = audioContext.createMediaStreamSource(stream);
                    analyser = audioContext.createAnalyser();
                    analyser.fftSize = 256;
                    microphone.connect(analyser);
                    detectBlow();
                } catch (err) {
                    console.error('Microphone access denied.', err);
                    instructionText.textContent = 'Mic access needed to blow!';
                }
            } else if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }

        function detectBlow() {
            if (!isCandleLit) return;

            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteFrequencyData(dataArray);

            let sum = dataArray.reduce((a, b) => a + b, 0);
            let average = sum / bufferLength;

            // Simple threshold detection for a "blow" sound
            if (average > 50) { // Adjust this threshold based on testing
                extinguishCandle();
            } else {
                requestAnimationFrame(detectBlow);
            }
        }

        function extinguishCandle() {
            if (!isCandleLit) return; // Prevent multiple triggers
            isCandleLit = false;
            
            // Animate flame out
            let scale = 1;
            const interval = setInterval(() => {
                scale -= 0.1;
                if (scale <= 0) {
                    flame.visible = false;
                    clearInterval(interval);
                } else {
                    flame.scale.set(scale, scale, scale);
                }
            }, 20);
            
            candleLight.intensity = 0;
            instructionText.textContent = "YAY! Happy Birthday, Sanci!";
            document.getElementById('blow-instruction').style.opacity = '1';

            // Trigger confetti burst!
            createConfetti();
        }
    </script>
</body>
</html>

