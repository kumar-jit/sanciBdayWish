<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Birthday wish âœ¨</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap"
            rel="stylesheet"
        />
        <style>
            body {
                font-family: "Poppins", sans-serif;
                background: linear-gradient(135deg, #ffdde1, #ee9ca7);
                overflow-x: hidden;
            }
            .text-shadow-pop {
                text-shadow: 2px 2px 0px rgba(255, 255, 255, 0.5),
                    4px 4px 0px rgba(0, 0, 0, 0.1);
            }
            .card {
                background: rgba(255, 255, 255, 0.2);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.3);
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }
            .card:hover {
                transform: translateY(-10px);
                box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
                    0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }
            .photo-placeholder {
                background: rgba(255, 255, 255, 0.3);
                border: 2px dashed #fff;
                position: relative;
                overflow: hidden;
            }
            .photo-placeholder::before {
                content: " ";
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: #fff;
                font-weight: 600;
                text-align: center;
            }
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            .fade-in {
                animation: fadeIn 1s ease-out forwards;
            }
            .delay-1 {
                animation-delay: 0.2s;
            }
            .delay-2 {
                animation-delay: 0.4s;
            }
            .delay-3 {
                animation-delay: 0.6s;
            }
            .delay-4 {
                animation-delay: 0.8s;
            }
            .delay-5 {
                animation-delay: 1s;
            }
            .delay-6 {
                animation-delay: 1.2s;
            }

            #cake-canvas {
                cursor: grab;
            }
            #cake-canvas:active {
                cursor: grabbing;
            }
            #blow-instruction {
                transition: opacity 0.5s;
            }

            /* Horizontal scroll container */
            .horizontal-scroll-container {
                -ms-overflow-style: none; /* IE and Edge */
                scrollbar-width: none; /* Firefox */
                overflow-x: auto;
            }
            .horizontal-scroll-container::-webkit-scrollbar {
                display: none; /* Chrome, Safari, Opera */
            }

            /* Apple-style scroll animation element */
            .scroll-pop {
                transform: scale(0.7) rotate(5deg);
                opacity: 0.3;
                transition: transform 0.2s ease-out, opacity 0.2s ease-out;
            }
            #loading {
                margin: 0;
                display: flex;
                justify-content: center;
                align-items: center;
                min-height: 100vh;
                background: linear-gradient(135deg, #fce4ec, #f8bbd0);
                font-family: "Arial", sans-serif;
                color: #c2185b;
                overflow: hidden;
            }

            .loading-container {
                display: flex;
                flex-direction: column;
                align-items: center;
                text-align: center;
                padding: 20px;
                background: #fff;
                border-radius: 20px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
                transform: scale(0.9);
                animation: pop-in 0.5s forwards
                    cubic-bezier(0.25, 0.46, 0.45, 0.94);
            }

            @keyframes pop-in {
                from {
                    transform: scale(0.7);
                    opacity: 0;
                }
                to {
                    transform: scale(1);
                    opacity: 1;
                }
            }

            .cake-graphic {
                position: relative;
                width: 150px;
                height: 150px;
                margin-bottom: 30px;
            }

            .cake-layer {
                position: absolute;
                width: 100%;
                border-radius: 50%;
                background-color: #ffc0cb;
                box-shadow: inset 0 -5px 10px rgba(0, 0, 0, 0.1);
                animation: bake 2s infinite alternate ease-in-out;
            }

            .cake-layer.bottom {
                height: 50px;
                bottom: 0;
                z-index: 1;
                animation-delay: 0.2s;
            }

            .cake-layer.middle {
                height: 40px;
                bottom: 30px;
                z-index: 2;
                animation-delay: 0.1s;
            }

            .cake-layer.top {
                height: 30px;
                bottom: 55px;
                z-index: 3;
            }

            @keyframes bake {
                from {
                    transform: scaleX(1);
                }
                to {
                    transform: scaleX(0.95);
                }
            }

            .frosting {
                position: absolute;
                width: 105%;
                height: 20px;
                bottom: 70px;
                left: -2.5%;
                background: #fff;
                border-radius: 50%;
                z-index: 4;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
                animation: drip 1.5s infinite alternate ease-in-out;
            }

            @keyframes drip {
                0% {
                    transform: translateY(0);
                }
                100% {
                    transform: translateY(3px);
                }
            }

            .cherry {
                position: absolute;
                width: 15px;
                height: 15px;
                background-color: #d62828;
                border-radius: 50%;
                top: 60px;
                left: 50%;
                transform: translateX(-50%);
                z-index: 5;
                box-shadow: inset 0 -2px 5px rgba(0, 0, 0, 0.2);
                animation: glow 1s infinite alternate ease-in-out;
            }

            @keyframes glow {
                from {
                    box-shadow: 0 0 5px #d62828;
                }
                to {
                    box-shadow: 0 0 15px #d62828;
                }
            }

            .countdown-content h1 {
                font-size: 1.8em;
                color: #d81b60;
                margin-top: 0;
                font-weight: bold;
            }

            .countdown-content p {
                font-size: 1em;
                color: #c2185b;
                margin-bottom: 20px;
            }

            .countdown-timer {
                display: flex;
                gap: 15px;
                justify-content: center;
            }

            .timer-box {
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 10px 15px;
                background-color: #ffc0cb;
                border-radius: 8px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
                min-width: 60px;
                transition: transform 0.3s ease;
            }

            .timer-box:hover {
                transform: translateY(-5px);
            }

            .timer-box span {
                font-size: 2em;
                font-weight: bold;
                color: #fff;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            .timer-box p {
                font-size: 0.8em;
                margin: 0;
                color: #c2185b;
            }

            /* Responsive design for smaller screens */
            @media (max-width: 600px) {
                .countdown-timer {
                    flex-wrap: wrap;
                    justify-content: center;
                    gap: 10px;
                }
                .timer-box {
                    min-width: 50px;
                    padding: 8px 12px;
                }
                .timer-box span {
                    font-size: 1.5em;
                }
            }
        </style>
    </head>
    <body class="text-gray-800">
        <div id="loading">
            <div class="loading-container">
                <div class="cake-graphic">
                    <div class="cake-layer bottom"></div>
                    <div class="cake-layer middle"></div>
                    <div class="cake-layer top"></div>
                    <div class="frosting"></div>
                    <div class="cherry"></div>
                </div>
                <div class="countdown-content">
                    <h1>Baking in progress...</h1>
                    <p>Please wait while your cake bakes.</p>
                    <div class="countdown-timer">
                        <div class="timer-box">
                            <span id="days">00</span>
                            <p>Days</p>
                        </div>
                        <div class="timer-box">
                            <span id="hours">00</span>
                            <p>Hours</p>
                        </div>
                        <div class="timer-box">
                            <span id="minutes">00</span>
                            <p>Minutes</p>
                        </div>
                        <div class="timer-box">
                            <span id="seconds">00</span>
                            <p>Seconds</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div
            id="cake"
            class="container mx-auto px-4 py-8 min-h-screen flex flex-col justify-center items-center"
        >
            <!-- Main Title -->
            <header class="text-center mb-8">
                <p
                    class="text-xl text-white mt-2 font-semibold fade-in delay-1"
                >
                    Hello Madam Jiiii
                </p>
                <br />

                <h1
                    class="text-5xl md:text-7xl font-black text-white text-shadow-pop fade-in"
                >
                    Happy Birthday SANCIAAAA! ðŸ¥³
                </h1>
            </header>
            <br />
            <!-- Photo Gallery Section -->
            <section class="w-full max-w-5xl text-center mb-8">
                <h2 class="text-3xl font-bold text-white mb-6 fade-in delay-2">
                    Your Memories ðŸ“·
                </h2>
                <div class="horizontal-scroll-container" id="photo-scroller">
                    <div class="flex gap-6 pb-4 px-[50vw]">
                        <!-- User will replace these divs with img tags -->
                        <div
                            class="photo-placeholder w-40 h-40 md:w-52 md:h-52 flex-shrink-0 rounded-2xl card scroll-pop"
                        >
                            <img src="./images/IMG_20250907_210424.jpg" />
                        </div>
                        <div
                            class="photo-placeholder w-40 h-40 md:w-52 md:h-52 flex-shrink-0 rounded-2xl card scroll-pop"
                        >
                            <img src="./images/IMG_20250907_210353.jpg" />
                        </div>
                        <div
                            class="photo-placeholder w-40 h-40 md:w-52 md:h-52 flex-shrink-0 rounded-2xl card scroll-pop"
                        >
                            <img src="./images/IMG_20250907_205646_611.jpg" />
                        </div>
                        <div
                            class="photo-placeholder w-40 h-40 md:w-52 md:h-52 flex-shrink-0 rounded-2xl card scroll-pop"
                        >
                            <img src="./images/IMG_20250907_210324.jpg" />
                        </div>
                        <div
                            class="photo-placeholder w-40 h-40 md:w-52 md:h-52 flex-shrink-0 rounded-2xl card scroll-pop"
                            style="visibility: hidden"
                        ></div>
                        <div
                            class="photo-placeholder w-40 h-40 md:w-52 md:h-52 flex-shrink-0 rounded-2xl card scroll-pop"
                            style="visibility: hidden"
                        ></div>
                    </div>
                </div>
            </section>

            <!-- 3D Cake Section -->
            <div class="w-full max-w-lg h-96 mb-8 fade-in delay-4">
                <div
                    id="cake-container"
                    class="relative w-full h-full rounded-2xl overflow-hidden"
                >
                    <canvas id="cake-canvas"></canvas>
                    <div
                        id="blow-instruction"
                        class="absolute bottom-4 left-1/2 -translate-x-1/2 text-center text-white bg-black bg-opacity-30 p-2 rounded-lg pointer-events-none"
                    >
                        <p id="instruction-text" class="font-semibold">
                            Click to light the candle!
                        </p>
                    </div>
                </div>
            </div>

            <!-- Wishes Section -->
            <section class="w-full max-w-4xl text-center mb-12">
                <h2 class="text-3xl font-bold text-white mb-6 fade-in delay-5">
                    Best wishes for you ðŸ‘¸
                </h2>
                <div class="grid md:grid-cols-1 gap-6">
                    <div class="card p-12 rounded-2xl fade-in delay-6">
                        <h3 class="font-bold text-xl mb-2 text-white text-700">
                            Keep Smiling... Happiness looks gorgeous on you...
                            ðŸ’—
                        </h3>
                        <p class="text-pink-900">
                            Youâ€™re doing amazing, and Iâ€™m so proud of how far
                            youâ€™ve come. Keep shining, keep growing, and never
                            stop believing in your magic. ðŸ’« <br />May every
                            single dream youâ€™ve been manifesting finally come
                            true.... <br />And most improtant Stay HAPPY ðŸ˜‡...
                        </p>
                    </div>
                    <!-- <div class="card p-6 rounded-2xl fade-in delay-6">
                    <h3 class="font-bold text-xl mb-2 text-pink-700">Manifesting the best for you âœ¨</h3>
                    <p class="text-pink-900">Wishing you a year of success, happiness, and hitting all your goals. Go get 'em, queen!</p>
                </div> -->
                </div>
            </section>

            <footer class="text-center text-white mt-12 pb-4 fade-in delay-6">
                <p>A small gesture to make your special day more special.</p>
            </footer>
        </div>

        <script>
            const daysEl = document.getElementById("days");
            const hoursEl = document.getElementById("hours");
            const minutesEl = document.getElementById("minutes");
            const secondsEl = document.getElementById("seconds");

            // Set the target date and time to September 8, 2025, at 12:00 AM IST.
            const targetDate = new Date("September 8, 2026 00:00:00 GMT+0530");

            function updateCountdown() {
                const currentTime = new Date();
                const timeDifference = targetDate - currentTime;

                // count calculation
                // If the countdown is over, clear the interval and update the message
                if (timeDifference <= 0) {
                    clearInterval(countdownInterval);
                    daysEl.textContent = "00";
                    hoursEl.textContent = "00";
                    minutesEl.textContent = "00";
                    secondsEl.textContent = "00";
                    document.getElementById("cake").style.display =
                        "flex";
                    document.getElementById("loading").style.display =
                        "none";
                    return;
                } else {
                    document.getElementById("cake").style.display = "none";
                    document.getElementById("loading").style.display =
                        "flex";
                }

                // Calculate days, hours, minutes, and seconds from the time difference
                const days = Math.floor(timeDifference / (1000 * 60 * 60 * 24));
                const hours = Math.floor(
                    (timeDifference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
                );
                const minutes = Math.floor(
                    (timeDifference % (1000 * 60 * 60)) / (1000 * 60)
                );
                const seconds = Math.floor(
                    (timeDifference % (1000 * 60)) / 1000
                );

                // Update the HTML elements with the calculated values
                daysEl.textContent = String(days).padStart(2, "0");
                hoursEl.textContent = String(hours).padStart(2, "0");
                minutesEl.textContent = String(minutes).padStart(2, "0");
                secondsEl.textContent = String(seconds).padStart(2, "0");
            }

            // Update the countdown every second
            const countdownInterval = setInterval(updateCountdown, 1000);

            // Initial call to update the countdown immediately on page load
            updateCountdown();
            // --- THREE.JS SCENE SETUP ---
            const canvas = document.getElementById("cake-canvas");
            const container = document.getElementById("cake-container");
            let scene,
                camera,
                renderer,
                cake,
                candleLight,
                flame,
                confetti_particles,
                ambient_particles;
            let isCandleLit = false;

            function init3D() {
                scene = new THREE.Scene();

                // Camera
                camera = new THREE.PerspectiveCamera(
                    75,
                    container.clientWidth / container.clientHeight,
                    0.1,
                    1000
                );
                camera.position.z = 8;
                camera.position.y = 3;

                // Renderer
                renderer = new THREE.WebGLRenderer({
                    canvas: canvas,
                    antialias: true,
                    alpha: true,
                });
                renderer.setSize(container.clientWidth, container.clientHeight);
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.shadowMap.enabled = true;
                renderer.toneMapping = THREE.ACESFilmicToneMapping;
                renderer.toneMappingExposure = 1.2;

                // Lighting
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
                scene.add(ambientLight);
                const hemisphereLight = new THREE.HemisphereLight(
                    0xffeeb1,
                    0x080820,
                    0.4
                );
                scene.add(hemisphereLight);
                const directionalLight = new THREE.DirectionalLight(
                    0xffffff,
                    0.8
                );
                directionalLight.position.set(5, 10, 7.5);
                directionalLight.castShadow = true;
                directionalLight.shadow.mapSize.width = 2048;
                directionalLight.shadow.mapSize.height = 2048;
                scene.add(directionalLight);

                // Cake
                createCake();
                createAmbientParticles();

                // Controls for rotation
                let isDragging = false;
                let previousMousePosition = { x: 0, y: 0 };

                const onMouseDown = (e) => {
                    isDragging = true;
                };
                const onMouseUp = () => {
                    isDragging = false;
                };
                const onMouseMove = (e) => {
                    if (!isDragging) return;
                    const deltaMove = {
                        x: e.offsetX - previousMousePosition.x,
                    };
                    if (cake) cake.rotation.y += deltaMove.x * 0.01;
                    previousMousePosition = { x: e.offsetX, y: e.offsetY };
                };
                const onTouchStart = (e) => {
                    isDragging = true;
                    previousMousePosition = {
                        x: e.touches[0].clientX,
                        y: e.touches[0].clientY,
                    };
                };
                const onTouchMove = (e) => {
                    if (!isDragging) return;
                    const deltaMove = {
                        x: e.touches[0].clientX - previousMousePosition.x,
                    };
                    if (cake) cake.rotation.y += deltaMove.x * 0.02;
                    previousMousePosition = {
                        x: e.touches[0].clientX,
                        y: e.touches[0].clientY,
                    };
                };

                renderer.domElement.addEventListener("mousedown", onMouseDown);
                renderer.domElement.addEventListener("mouseup", onMouseUp);
                renderer.domElement.addEventListener("mousemove", onMouseMove);
                renderer.domElement.addEventListener(
                    "touchstart",
                    onTouchStart,
                    { passive: true }
                );
                renderer.domElement.addEventListener("touchend", onMouseUp);
                renderer.domElement.addEventListener("touchmove", onTouchMove, {
                    passive: true,
                });

                animate();
            }

            function createCake() {
                cake = new THREE.Group();

                // Cake Stand
                const standMaterial = new THREE.MeshStandardMaterial({
                    color: 0xffffff,
                    roughness: 0.1,
                    metalness: 0.2,
                });
                const standGeo = new THREE.CylinderGeometry(3.2, 3.2, 0.2, 64);
                const stand = new THREE.Mesh(standGeo, standMaterial);
                stand.position.y = -1.3;
                stand.receiveShadow = true;
                cake.add(stand);

                // Cake layers
                const baseMaterial = new THREE.MeshStandardMaterial({
                    color: 0x5c2626,
                    roughness: 0.8,
                });
                const baseGeometry = new THREE.CylinderGeometry(
                    2.4,
                    2.4,
                    1.2,
                    64
                );
                const base = new THREE.Mesh(baseGeometry, baseMaterial);
                base.position.y = -0.6;
                base.castShadow = true;
                base.receiveShadow = true;
                cake.add(base);

                const topLayerMaterial = new THREE.MeshStandardMaterial({
                    color: 0x8b4513,
                    roughness: 0.8,
                });
                const topLayerGeometry = new THREE.CylinderGeometry(
                    1.8,
                    1.8,
                    1,
                    64
                );
                const topLayer = new THREE.Mesh(
                    topLayerGeometry,
                    topLayerMaterial
                );
                topLayer.position.y = 0.5;
                topLayer.castShadow = true;
                topLayer.receiveShadow = true;
                cake.add(topLayer);

                // Icing Drip
                const icingMaterial = new THREE.MeshStandardMaterial({
                    color: 0xf5f5dc,
                    roughness: 0.5,
                });
                const icingGeometry = new THREE.TorusGeometry(
                    2.1,
                    0.35,
                    16,
                    100
                );
                const icing = new THREE.Mesh(icingGeometry, icingMaterial);
                icing.rotation.x = Math.PI / 2;
                icing.position.y = 0;
                cake.add(icing);

                // Sprinkles
                const sprinkleGeometry = new THREE.CylinderGeometry(
                    0.02,
                    0.02,
                    0.1,
                    8
                );
                const sprinkleColors = [0xffd700, 0xffafcc, 0x87ceeb];
                for (let i = 0; i < 200; i++) {
                    const sprinkleMaterial = new THREE.MeshBasicMaterial({
                        color: sprinkleColors[
                            Math.floor(Math.random() * sprinkleColors.length)
                        ],
                    });
                    const sprinkle = new THREE.Mesh(
                        sprinkleGeometry,
                        sprinkleMaterial
                    );
                    const angle = Math.random() * Math.PI * 2;
                    const radius = Math.random() * 1.7;
                    sprinkle.position.set(
                        Math.cos(angle) * radius,
                        1.05,
                        Math.sin(angle) * radius
                    );
                    sprinkle.rotation.set(
                        Math.PI / 2,
                        Math.random() * Math.PI,
                        0
                    );
                    cake.add(sprinkle);
                }

                // Candle
                const candle = new THREE.Group();
                const waxMaterial = new THREE.MeshStandardMaterial({
                    color: 0xfefae0,
                });
                const waxGeometry = new THREE.CylinderGeometry(
                    0.08,
                    0.08,
                    0.7,
                    16
                );
                const wax = new THREE.Mesh(waxGeometry, waxMaterial);
                wax.castShadow = true;
                candle.add(wax);

                // Flame
                const flameMaterial = new THREE.MeshBasicMaterial({
                    color: 0xffd700,
                });
                const flameGeometry = new THREE.ConeGeometry(0.08, 0.2, 16);
                flame = new THREE.Mesh(flameGeometry, flameMaterial);
                flame.position.y = 0.45;
                flame.visible = false;
                candle.add(flame);

                candle.position.y = 1.35;
                cake.add(candle);

                // Candle Light
                candleLight = new THREE.PointLight(0xffc58a, 1, 100);
                candleLight.position.set(0, 2, 0);
                candleLight.castShadow = true;
                candleLight.intensity = 0;
                scene.add(candleLight);

                scene.add(cake);
            }

            function createAmbientParticles() {
                const particleCount = 1000;
                const positions = new Float32Array(particleCount * 3);
                for (let i = 0; i < particleCount * 3; i++) {
                    positions[i] = (Math.random() - 0.5) * 20;
                }
                const particleGeometry = new THREE.BufferGeometry();
                particleGeometry.setAttribute(
                    "position",
                    new THREE.BufferAttribute(positions, 3)
                );
                const particleMaterial = new THREE.PointsMaterial({
                    color: 0xffffff,
                    size: 0.02,
                    transparent: true,
                    opacity: 0.5,
                    blending: THREE.AdditiveBlending,
                });
                ambient_particles = new THREE.Points(
                    particleGeometry,
                    particleMaterial
                );
                scene.add(ambient_particles);
            }

            function createConfetti() {
                const confettiCount = 500;
                const confettiGeometry = new THREE.PlaneGeometry(0.07, 0.07);
                const colors = [
                    0xffd700, 0xffafcc, 0xffffff, 0xee9ca7, 0x8b4513,
                ];
                confetti_particles = new THREE.Group();

                for (let i = 0; i < confettiCount; i++) {
                    const confettiMaterial = new THREE.MeshBasicMaterial({
                        color: colors[
                            Math.floor(Math.random() * colors.length)
                        ],
                        side: THREE.DoubleSide,
                    });
                    const particle = new THREE.Mesh(
                        confettiGeometry,
                        confettiMaterial
                    );
                    particle.position.set(
                        (Math.random() - 0.5) * 0.5,
                        3 + Math.random() * 2,
                        (Math.random() - 0.5) * 0.5
                    );
                    particle.rotation.set(
                        Math.random() * Math.PI,
                        Math.random() * Math.PI,
                        Math.random() * Math.PI
                    );
                    particle.velocity = new THREE.Vector3(
                        (Math.random() - 0.5) * 0.04,
                        Math.random() * 0.06 + 0.06,
                        (Math.random() - 0.5) * 0.04
                    );
                    particle.rotationSpeed = new THREE.Vector3(
                        (Math.random() - 0.5) * 0.1,
                        (Math.random() - 0.5) * 0.1,
                        (Math.random() - 0.5) * 0.1
                    );
                    confetti_particles.add(particle);
                }
                scene.add(confetti_particles);
            }

            function animate() {
                requestAnimationFrame(animate);
                const time = Date.now() * 0.0005;

                if (flame && flame.visible) {
                    flame.scale.y = 1 + Math.sin(Date.now() * 0.05) * 0.1;
                    flame.scale.x = 1 + Math.cos(Date.now() * 0.05) * 0.05;
                    candleLight.intensity =
                        1.5 + Math.sin(Date.now() * 0.05) * 0.2;
                }

                if (confetti_particles) {
                    confetti_particles.children.forEach((p) => {
                        p.position.add(p.velocity);
                        p.velocity.y -= 0.0009;
                        p.rotation.x += p.rotationSpeed.x;
                        p.rotation.y += p.rotationSpeed.y;
                        p.rotation.z += p.rotationSpeed.z;
                        if (p.position.y < -4) {
                            p.position.y = 4;
                            p.velocity.y = Math.random() * 0.05 + 0.02;
                        }
                    });
                }

                if (ambient_particles) {
                    ambient_particles.rotation.y = time * 0.2;
                }

                renderer.render(scene, camera);
            }

            function onWindowResize() {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            }
            window.addEventListener("resize", onWindowResize, false);
            init3D();

            // --- BLOWING FEATURE ---
            let audioContext;
            let analyser;
            let microphone;
            const instructionText = document.getElementById("instruction-text");
            canvas.addEventListener("click", () => {
                if (!isCandleLit) {
                    lightCandle();
                }
            });
            async function lightCandle() {
                isCandleLit = true;
                flame.visible = true;
                candleLight.intensity = 2;
                instructionText.textContent =
                    "Make a wish and blow out the candle!";
                if (!audioContext) {
                    try {
                        audioContext = new (window.AudioContext ||
                            window.webkitAudioContext)();
                        const stream =
                            await navigator.mediaDevices.getUserMedia({
                                audio: true,
                            });
                        microphone =
                            audioContext.createMediaStreamSource(stream);
                        analyser = audioContext.createAnalyser();
                        analyser.fftSize = 256;
                        microphone.connect(analyser);
                        detectBlow();
                    } catch (err) {
                        instructionText.textContent =
                            "Mic access needed to blow!";
                    }
                } else if (audioContext.state === "suspended") {
                    audioContext.resume();
                }
            }
            function detectBlow() {
                if (!isCandleLit) return;
                const dataArray = new Uint8Array(analyser.frequencyBinCount);
                analyser.getByteFrequencyData(dataArray);
                let average =
                    dataArray.reduce((a, b) => a + b, 0) /
                    analyser.frequencyBinCount;
                if (average > 50) {
                    extinguishCandle();
                } else {
                    requestAnimationFrame(detectBlow);
                }
            }
            function extinguishCandle() {
                if (!isCandleLit) return;
                isCandleLit = false;
                let scale = 1;
                const interval = setInterval(() => {
                    scale -= 0.1;
                    if (scale <= 0) {
                        flame.visible = false;
                        clearInterval(interval);
                    } else {
                        flame.scale.set(scale, scale, scale);
                    }
                }, 20);
                candleLight.intensity = 0;
                instructionText.textContent = "YAY! Happy Birthday, Sancia ðŸ˜!";
                createConfetti();
            }

            // --- iPhone Style Scroll Animation ---
            const scroller = document.getElementById("photo-scroller");
            const scrollItems = document.querySelectorAll(".scroll-pop");

            function handleScroll() {
                const scrollerCenter = scroller.offsetWidth / 2;

                scrollItems.forEach((item) => {
                    const itemRect = item.getBoundingClientRect();
                    const scrollerRect = scroller.getBoundingClientRect();

                    // Calculate the center of the item relative to the scroller's viewport
                    const itemCenter =
                        itemRect.left -
                        scrollerRect.left +
                        item.offsetWidth / 2;

                    // Calculate distance from the scroller's center
                    const distance = Math.abs(scrollerCenter - itemCenter);

                    // Calculate scale and opacity based on distance
                    // The further away, the smaller and more transparent it gets
                    const scale = Math.max(
                        0.7,
                        1 - distance / scrollerCenter / 3
                    );
                    const opacity = Math.max(
                        0.3,
                        1 - distance / scrollerCenter / 1.5
                    );

                    // Calculate rotation
                    const rotation = (itemCenter - scrollerCenter) / 20;

                    item.style.transform = `scale(${scale}) rotate(${rotation}deg)`;
                    item.style.opacity = opacity;
                });
            }

            scroller.addEventListener("scroll", handleScroll);
            // Initial call to set positions
            handleScroll();
        </script>
    </body>
</html>
